[pytest]
# Chemins de recherche des tests
testpaths = tests
python_files = test_*.py
python_functions = test_*
python_classes = Test*
# Pour ajouter des chemins au PYTHONPATH, utilisez l'option -p dans addopts
# ou définissez la variable d'environnement PYTHONPATH

# Options de test
addopts = 
    -v 
    --tb=short
    --strict-markers
    --strict-config
    -p no:warnings
    -p no:cacheprovider
    --asyncio-mode=auto
    --import-mode=importlib
    --cov=app
    --cov-report=term-missing
    --cov-report=xml
    --cov-fail-under=20

# Configuration pour asyncio
asyncio_mode = auto

# Configuration de la couverture de code
# La configuration de couverture est gérée par les options --cov et --cov-report dans addopts

# Configuration des marqueurs personnalisés
markers =
    slow: marks tests as slow (deselect with '-m "not slow"')
    integration: mark test as integration test
    unit: mark test as unit test
    async_test: mark test as async test
    api: mark test as API test
    performance: mark test as performance test
    e2e: mark test as end-to-end test
    db: mark test as database test
    auth: mark test as authentication test
    load_test: mark test as load test
    security: mark test as security test

# Configuration des filtres d'avertissements
filterwarnings =
    ignore::DeprecationWarning
    ignore::pytest.PytestUnhandledThreadExceptionWarning
    ignore::pytest.PytestUnraisableExceptionWarning
    ignore::ResourceWarning

# Ignorer les répertoires de l'environnement virtuel et de cache
norecursedirs = .git .tox .pytest_cache __pycache__ venv env .venv .mypy_cache .vscode

# Configuration de la couverture de code
[pytest-cov]
source = app
omit = 
    app/tests/**
    **/__pycache__/**
    **/migrations/**
    **/venv/**
    **/.venv/**
    **/env/**
    **/.env/**
    app/config.py
    app/database/*
    app/db/*

# Configuration pour pytest-asyncio
[pytest-asyncio]
asyncio_mode = auto

# Configuration pour les logs
log_cli = true
log_cli_level = INFO
log_cli_format = %(asctime)s [%(levelname)8s] %(message)s (%(filename)s:%(lineno)s)
log_cli_date_format = %Y-%m-%d %H:%M:%S

# Configuration pour les avertissements
filterwarnings =
    ignore::DeprecationWarning
    ignore::UserWarning
    ignore::RuntimeWarning
    ignore::FutureWarning
    ignore::_pytest.unraisableexception.PytestUnraisableExceptionWarning
    ignore:Exception ignored in:pytest.PytestUnraisableExceptionWarning
    ignore:Exception ignored in:.*gzip.*:pytest.PytestUnraisableExceptionWarning
